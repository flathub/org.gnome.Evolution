From 738ca7723da961d537082db615460ae627c7693b Mon Sep 17 00:00:00 2001
From: Milan Crha <mcrha@redhat.com>
Date: Tue, 14 May 2024 18:50:45 +0200
Subject: [PATCH] Misc: Replace XPM images with SVG images

The GdkPixbuf removed the XPM loader, thus convert the XPM images
into a more recent format and use that instead.
---
 data/images/README                       | 46 ------------------------
 data/images/arrow-down.svg               | 21 +++++++++++
 data/images/arrow-up.svg                 | 21 +++++++++++
 data/images/empty.svg                    | 16 +++++++++
 data/images/jump-focused.svg             | 33 +++++++++++++++++
 data/images/jump.svg                     | 33 +++++++++++++++++
 data/org.gnome.Evolution.gresource.xml   |  5 +++
 data/xpm/arrow-down.xpm                  | 21 -----------
 data/xpm/arrow-up.xpm                    | 21 -----------
 data/xpm/empty.xpm                       | 21 -----------
 data/xpm/jump.xpm                        | 30 ----------------
 src/calendar/gui/e-week-view.c           | 33 +++++++++--------
 src/calendar/gui/print.c                 | 30 ++++++++--------
 src/e-util/e-cell-toggle.c               | 10 +++---
 src/e-util/e-table-header-item.c         | 18 ++++++----
 src/em-format/e-mail-formatter-headers.c |  1 +
 src/mail/message-list.c                  |  1 -
 17 files changed, 180 insertions(+), 181 deletions(-)
 delete mode 100644 data/images/README
 create mode 100644 data/images/arrow-down.svg
 create mode 100644 data/images/arrow-up.svg
 create mode 100644 data/images/empty.svg
 create mode 100644 data/images/jump-focused.svg
 create mode 100644 data/images/jump.svg
 delete mode 100644 data/xpm/arrow-down.xpm
 delete mode 100644 data/xpm/arrow-up.xpm
 delete mode 100644 data/xpm/empty.xpm
 delete mode 100644 data/xpm/jump.xpm

diff --git a/data/images/README b/data/images/README
deleted file mode 100644
index 9f78332ce1..0000000000
--- a/data/images/README
+++ /dev/null
@@ -1,46 +0,0 @@
-Evolution Icons
-===============
-
-Licensing
----------
-
-FIXME: add license info here.
-
-
-Adding Icons
-------------
-
-Icons that are meant to someday be themeable MUST be for one or more
-of the following sizes:
-
-- 16x16
-- 18x18
-- 20x20
-- 24x24
-- 32x32
-- 48x48
-
-(the following sizes may also be added for use with window
-decorations: 64x64 and 128x128)
-
-All icons should be named consistantly and be placed within the proper
-subdir that corresponds to their size (if the subdir does not yet
-exist, because no icons have been made for that size - then create the
-subdir and add it to the build as well).
-
-If it is expected that the icon(s) you've created will make it into
-the GNOME icon themes package at some point (or is already there?),
-then you will want to name your icons accordingly so that if the user
-installs a GNOME icons theme package with the appropriate icon(s),
-then he or she will see those icons rather than the ones installed by
-default with Evolution.
-
-The icons within the WWxHH subdirs will ONLY be used if they cnnot be
-found in the theme.
-
-The ONLY image files that may be placed in the toplevel art/ srcdir
-(eg. *this* dir) are xpm files that are built into the Evolution binary
-(or libs) and/or are not meant to be used as "icons".
-
-
--- fejj
diff --git a/data/images/arrow-down.svg b/data/images/arrow-down.svg
new file mode 100644
index 0000000000..656e5be3fa
--- /dev/null
+++ b/data/images/arrow-down.svg
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+
+<svg
+   width="13"
+   height="16"
+   viewBox="0 0 3.4395833 4.2333333"
+   version="1.1"
+   id="svg15599"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:svg="http://www.w3.org/2000/svg">
+  <defs
+     id="defs15596" />
+  <g
+     id="layer1">
+    <path
+       style="fill:#ff0000;fill-rule:evenodd;stroke:none;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="m 1.7197917,4.1010416 -1.58750003,-1.5875 H 1.4552083 V 0.13229167 H 1.984375 V 2.5135416 h 1.3229167 z"
+       id="path15722" />
+  </g>
+</svg>
diff --git a/data/images/arrow-up.svg b/data/images/arrow-up.svg
new file mode 100644
index 0000000000..67f11635c7
--- /dev/null
+++ b/data/images/arrow-up.svg
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+
+<svg
+   width="13"
+   height="16"
+   viewBox="0 0 3.4395833 4.2333333"
+   version="1.1"
+   id="svg15599"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:svg="http://www.w3.org/2000/svg">
+  <defs
+     id="defs15596" />
+  <g
+     id="layer1">
+    <path
+       style="fill:#ff0000;fill-rule:evenodd;stroke:none;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="M 1.7197917,0.13229167 0.13229167,1.7197917 H 1.4552083 V 4.1010416 H 1.984375 V 1.7197917 l 1.3229167,0 z"
+       id="path15722" />
+  </g>
+</svg>
diff --git a/data/images/empty.svg b/data/images/empty.svg
new file mode 100644
index 0000000000..27a239a29d
--- /dev/null
+++ b/data/images/empty.svg
@@ -0,0 +1,16 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+
+<svg
+   width="16"
+   height="16"
+   viewBox="0 0 4.2333332 4.2333333"
+   version="1.1"
+   id="svg14366"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:svg="http://www.w3.org/2000/svg">
+  <defs
+     id="defs14363" />
+  <g
+     id="layer1" />
+</svg>
diff --git a/data/images/jump-focused.svg b/data/images/jump-focused.svg
new file mode 100644
index 0000000000..ef8b123ed7
--- /dev/null
+++ b/data/images/jump-focused.svg
@@ -0,0 +1,33 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+
+<svg
+   width="16"
+   height="8"
+   viewBox="0 0 4.2333332 2.1166667"
+   version="1.1"
+   id="svg337"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:svg="http://www.w3.org/2000/svg">
+  <defs
+     id="defs334" />
+  <g
+     id="layer1">
+    <path
+       style="fill:#ffff00;fill-rule:evenodd;stroke:#0000ff;stroke-width:0.529167;stroke-linecap:butt;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1"
+       d="M 0.26458334,0.26458334 H 3.9687501 V 1.8520834 H 0.26458334 Z"
+       id="path523" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#0000ff;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="m 0.92604168,0.92604168 0.26458332,1e-8 c 1e-7,0.0729746 1e-7,0.13651721 0,0.26458331 l -0.26458332,0 z"
+       id="path3987" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#0000ff;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="M 1.984375,0.92604169 V 1.190625 H 2.2489585 V 0.92604168 Z"
+       id="path4715" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#0000ff;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="m 3.3072916,0.92604168 -0.2645832,1e-8 V 1.190625 l 0.2645832,0 z"
+       id="path5497" />
+  </g>
+</svg>
diff --git a/data/images/jump.svg b/data/images/jump.svg
new file mode 100644
index 0000000000..62fce6a184
--- /dev/null
+++ b/data/images/jump.svg
@@ -0,0 +1,33 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+
+<svg
+   width="16"
+   height="8"
+   viewBox="0 0 4.2333332 2.1166667"
+   version="1.1"
+   id="svg337"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:svg="http://www.w3.org/2000/svg">
+  <defs
+     id="defs334" />
+  <g
+     id="layer1">
+    <path
+       style="fill:#ffff00;fill-rule:evenodd;stroke:#000000;stroke-width:0.26458299;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;stroke-dasharray:none"
+       d="M 0.13229167,0.13229167 H 4.1010416 V 1.984375 H 0.13229167 Z"
+       id="path523" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="m 0.92604168,0.92604168 0.26458332,1e-8 c 1e-7,0.0729746 1e-7,0.13651721 0,0.26458331 l -0.26458332,0 z"
+       id="path3987" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="M 1.984375,0.92604169 V 1.190625 H 2.2489585 V 0.92604168 Z"
+       id="path4715" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.264583px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
+       d="m 3.3072916,0.92604168 -0.2645832,1e-8 V 1.190625 l 0.2645832,0 z"
+       id="path5497" />
+  </g>
+</svg>
diff --git a/data/org.gnome.Evolution.gresource.xml b/data/org.gnome.Evolution.gresource.xml
index 783ed153b8..54769882de 100644
--- a/data/org.gnome.Evolution.gresource.xml
+++ b/data/org.gnome.Evolution.gresource.xml
@@ -2,5 +2,10 @@
 <gresources>
   <gresource prefix="org.gnome.Evolution">
     <file>emoji.data</file>
+    <file alias="arrow-down.svg">images/arrow-down.svg</file>
+    <file alias="arrow-up.svg">images/arrow-up.svg</file>
+    <file alias="empty.svg">images/empty.svg</file>
+    <file alias="jump.svg">images/jump.svg</file>
+    <file alias="jump-focused.svg">images/jump-focused.svg</file>
   </gresource>
 </gresources>
diff --git a/data/xpm/arrow-down.xpm b/data/xpm/arrow-down.xpm
deleted file mode 100644
index f1e6cb4b3c..0000000000
--- a/data/xpm/arrow-down.xpm
+++ /dev/null
@@ -1,21 +0,0 @@
-/* XPM */
-static const char * arrow_down_xpm[] = {
-"13 16 2 1",
-" 	c None",
-".	c #FF0000",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-".............",
-" ........... ",
-"  .........  ",
-"   .......   ",
-"    .....    ",
-"     ...     ",
-"      .      "};
diff --git a/data/xpm/arrow-up.xpm b/data/xpm/arrow-up.xpm
deleted file mode 100644
index 0cc5b9a00c..0000000000
--- a/data/xpm/arrow-up.xpm
+++ /dev/null
@@ -1,21 +0,0 @@
-/* XPM */
-static const char * arrow_up_xpm[] = {
-"13 16 2 1",
-" 	c None",
-".	c #FF0000",
-"      .      ",
-"     ...     ",
-"    .....    ",
-"   .......   ",
-"  .........  ",
-" ........... ",
-".............",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     ",
-"     ...     "};
diff --git a/data/xpm/empty.xpm b/data/xpm/empty.xpm
deleted file mode 100644
index b6d9e9bada..0000000000
--- a/data/xpm/empty.xpm
+++ /dev/null
@@ -1,21 +0,0 @@
-/* XPM */
-static const gchar *empty_xpm[] = {
-"16 16 2 1",
-" 	c None",
-".	c #FFFFFF",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                ",
-"                "};
diff --git a/data/xpm/jump.xpm b/data/xpm/jump.xpm
deleted file mode 100644
index 1254a53a1b..0000000000
--- a/data/xpm/jump.xpm
+++ /dev/null
@@ -1,30 +0,0 @@
-/* XPM */
-static const gchar *jump_xpm[] = {
-"16 8 3 1",
-" 	c None",
-".	c #000000",
-"+	c #FFFF00",
-"................",
-".++++++++++++++.",
-".++++++++++++++.",
-".++..++..++..++.",
-".++..++..++..++.",
-".++++++++++++++.",
-".++++++++++++++.",
-"................"};
-
-static const gchar *jump_xpm_focused[] = {
-"16 8 3 1",
-"       c None",
-".      c #0000FF",
-"+      c #FFFF00",
-"................",
-"................",
-"..++++++++++++..",
-"..+..++..++..+..",
-"..+..++..++..+..",
-"..++++++++++++..",
-"................",
-"................"};
-                                                                                                                
-
diff --git a/src/calendar/gui/e-week-view.c b/src/calendar/gui/e-week-view.c
index f5003864a2..b432c394cc 100644
--- a/src/calendar/gui/e-week-view.c
+++ b/src/calendar/gui/e-week-view.c
@@ -48,9 +48,6 @@
 #include "print.h"
 #include "ea-week-view.h"
 
-/* Images */
-#include "data/xpm/jump.xpm"
-
 #define E_WEEK_VIEW_SMALL_FONT_PTSIZE 7
 
 #define E_WEEK_VIEW_JUMP_BUTTON_WIDTH	16
@@ -106,6 +103,9 @@ struct _EWeekViewPrivate {
 
 	gint drag_event_num;
 	gint drag_from_day;
+
+	GdkPixbuf *jump_pixbuf;
+	GdkPixbuf *jump_focused_pixbuf;
 };
 
 typedef struct {
@@ -901,6 +901,8 @@ week_view_dispose (GObject *object)
 	g_clear_object (&week_view->normal_cursor);
 	g_clear_object (&week_view->move_cursor);
 	g_clear_object (&week_view->resize_width_cursor);
+	g_clear_object (&week_view->priv->jump_pixbuf);
+	g_clear_object (&week_view->priv->jump_focused_pixbuf);
 
 	calendar_config_remove_notification (
 		month_scroll_by_week_changed_cb, week_view);
@@ -1913,7 +1915,7 @@ e_week_view_init (EWeekView *week_view)
 {
 	GnomeCanvasGroup *canvas_group;
 	GtkAdjustment *adjustment;
-	GdkPixbuf *pixbuf;
+	GError *error = NULL;
 	gint i;
 
 	week_view->priv = e_week_view_get_instance_private (week_view);
@@ -2052,13 +2054,21 @@ e_week_view_init (EWeekView *week_view)
 		GDK_ACTION_COPY | GDK_ACTION_MOVE);
 
 	/* Create the buttons to jump to each days. */
-	pixbuf = gdk_pixbuf_new_from_xpm_data ((const gchar **) jump_xpm);
+	week_view->priv->jump_pixbuf = gdk_pixbuf_new_from_resource ("/org.gnome.Evolution/jump.svg", &error);
+	if (!week_view->priv->jump_pixbuf)
+		g_warning ("%s: Failed to load 'jump.svg': %s", G_STRFUNC, error ? error->message : "Unknown error");
+	g_clear_error (&error);
+
+	week_view->priv->jump_focused_pixbuf = gdk_pixbuf_new_from_resource ("/org.gnome.Evolution/jump-focused.svg", &error);
+	if (!week_view->priv->jump_focused_pixbuf)
+		g_warning ("%s: Failed to load 'jump-focused.svg': %s", G_STRFUNC, error ? error->message : "Unknown error");
+	g_clear_error (&error);
 
 	for (i = 0; i < E_WEEK_VIEW_MAX_WEEKS * 7; i++) {
 		week_view->jump_buttons[i] = gnome_canvas_item_new
 			(canvas_group,
 			 gnome_canvas_pixbuf_get_type (),
-			 "GnomeCanvasPixbuf::pixbuf", pixbuf,
+			 "GnomeCanvasPixbuf::pixbuf", week_view->priv->jump_pixbuf,
 			 NULL);
 
 		g_signal_connect (
@@ -2067,8 +2077,6 @@ e_week_view_init (EWeekView *week_view)
 	}
 	week_view->focused_jump_button = E_WEEK_VIEW_JUMP_BUTTON_NO_FOCUS;
 
-	g_object_unref (pixbuf);
-
 	/*
 	 * Scrollbar.
 	 */
@@ -5365,7 +5373,6 @@ e_week_view_on_jump_button_event (GnomeCanvasItem *item,
 	}
 	else if (event->type == GDK_FOCUS_CHANGE) {
 		GdkEventFocus *focus_event = (GdkEventFocus *) event;
-		GdkPixbuf *pixbuf = NULL;
 
 		for (day = 0; day < E_WEEK_VIEW_MAX_WEEKS * 7; day++) {
 			if (item == week_view->jump_buttons[day])
@@ -5379,22 +5386,18 @@ e_week_view_on_jump_button_event (GnomeCanvasItem *item,
 
 		if (focus_event->in) {
 			week_view->focused_jump_button = day;
-			pixbuf = gdk_pixbuf_new_from_xpm_data ((const gchar **) jump_xpm_focused);
 			gnome_canvas_item_set (
 				week_view->jump_buttons[day],
 				"GnomeCanvasPixbuf::pixbuf",
-				pixbuf, NULL);
+				week_view->priv->jump_focused_pixbuf, NULL);
 		}
 		else {
 			week_view->focused_jump_button = E_WEEK_VIEW_JUMP_BUTTON_NO_FOCUS;
-			pixbuf = gdk_pixbuf_new_from_xpm_data ((const gchar **) jump_xpm);
 			gnome_canvas_item_set (
 				week_view->jump_buttons[day],
 				"GnomeCanvasPixbuf::pixbuf",
-				pixbuf, NULL);
+				week_view->priv->jump_pixbuf, NULL);
 		}
-		if (pixbuf)
-			g_object_unref (pixbuf);
 	}
 
 	return FALSE;
diff --git a/src/calendar/gui/print.c b/src/calendar/gui/print.c
index 697ec0f982..030fd3d48d 100644
--- a/src/calendar/gui/print.c
+++ b/src/calendar/gui/print.c
@@ -45,8 +45,6 @@
 #include "e-week-view-layout.h"
 #include "e-task-table.h"
 
-#include "data/xpm/jump.xpm"
-
 typedef struct PrintCompItem PrintCompItem;
 typedef struct PrintCalItem PrintCalItem;
 
@@ -1711,16 +1709,12 @@ print_day_details (GtkPrintContext *context,
 		gint x, y;
 
 		if (!pixbuf) {
-			const gchar **xpm = (const gchar **) jump_xpm;
-
-			/* this ugly thing is here only to get rid of compiler warning
-			 * about unused 'jump_xpm_focused' */
-			if (pixbuf) {
-				/* coverity[dead_error_line] */
-				xpm = (const gchar **) jump_xpm_focused;
-			}
+			GError *error = NULL;
 
-			pixbuf = gdk_pixbuf_new_from_xpm_data (xpm);
+			pixbuf = gdk_pixbuf_new_from_resource ("/org.gnome.Evolution/jump.svg", &error);
+			if (!pixbuf)
+				g_warning ("%s: Failed to load 'jump.svg': %s", G_STRFUNC, error ? error->message : "Unknown error");
+			g_clear_error (&error);
 		}
 
 		/* Right align - 10 comes from print_day_long_event  too */
@@ -2065,9 +2059,12 @@ print_week_event (GtkPrintContext *context,
 			}
 
 			if (!pixbuf) {
-				const gchar **xpm = (const gchar **) jump_xpm;
+				GError *error = NULL;
 
-				pixbuf = gdk_pixbuf_new_from_xpm_data (xpm);
+				pixbuf = gdk_pixbuf_new_from_resource ("/org.gnome.Evolution/jump.svg", &error);
+				if (!pixbuf)
+					g_warning ("%s: Failed to load 'jump.svg': %s", G_STRFUNC, error ? error->message : "Unknown error");
+				g_clear_error (&error);
 			}
 
 			x1 = left + (start_x + 1) * cell_width - 6 -
@@ -2899,9 +2896,12 @@ print_work_week_day_details (GtkPrintContext *context,
 		gint x, y;
 
 		if (!pixbuf) {
-			const gchar **xpm = (const gchar **) jump_xpm;
+			GError *error = NULL;
 
-			pixbuf = gdk_pixbuf_new_from_xpm_data (xpm);
+			pixbuf = gdk_pixbuf_new_from_resource ("/org.gnome.Evolution/jump.svg", &error);
+			if (!pixbuf)
+				g_warning ("%s: Failed to load 'jump.svg': %s", G_STRFUNC, error ? error->message : "Unknown error");
+			g_clear_error (&error);
 		}
 
 		/* Right align - 10 comes from print_day_long_event  too */
diff --git a/src/e-util/e-cell-toggle.c b/src/e-util/e-cell-toggle.c
index fb22638ed6..ffc68d092c 100644
--- a/src/e-util/e-cell-toggle.c
+++ b/src/e-util/e-cell-toggle.c
@@ -27,8 +27,6 @@
 #include <gtk/gtk.h>
 #include <libgnomecanvas/libgnomecanvas.h>
 
-#include "data/xpm/empty.xpm"
-
 #include "gal-a11y-e-cell-toggle.h"
 #include "gal-a11y-e-cell-registry.h"
 
@@ -530,12 +528,16 @@ e_cell_toggle_class_init (ECellToggleClass *class)
 static void
 e_cell_toggle_init (ECellToggle *cell_toggle)
 {
-	cell_toggle->priv = e_cell_toggle_get_instance_private (cell_toggle);
+	GError *error = NULL;
 
-	cell_toggle->priv->empty = gdk_pixbuf_new_from_xpm_data (empty_xpm);
+	cell_toggle->priv = e_cell_toggle_get_instance_private (cell_toggle);
 	cell_toggle->priv->surfaces = g_ptr_array_new_with_free_func (surface_data_free);
 	cell_toggle->priv->surface_scale = 0;
 	cell_toggle->priv->bg_color_column = -1;
+	cell_toggle->priv->empty = gdk_pixbuf_new_from_resource ("/org.gnome.Evolution/empty.svg", &error);
+	if (!cell_toggle->priv->empty)
+		g_warning ("%s: Failed to load 'empty.svg': %s", G_STRFUNC, error ? error->message : "Unknown error");
+	g_clear_error (&error);
 }
 
 /**
diff --git a/src/e-util/e-table-header-item.c b/src/e-util/e-table-header-item.c
index 97cccbcc7d..92b23297d3 100644
--- a/src/e-util/e-table-header-item.c
+++ b/src/e-util/e-table-header-item.c
@@ -44,9 +44,6 @@
 #include "e-table.h"
 #include "e-xml-utils.h"
 
-#include "data/xpm/arrow-up.xpm"
-#include "data/xpm/arrow-down.xpm"
-
 enum {
 	BUTTON_PRESSED,
 	HEADER_CLICK_CAN_SORT,
@@ -446,12 +443,19 @@ ethi_remove_drop_marker (ETableHeaderItem *ethi)
 }
 
 static GtkWidget *
-make_shaped_window_from_xpm (const gchar **xpm)
+make_shaped_window_from_svg (const gchar *image_name)
 {
 	GdkPixbuf *pixbuf;
 	GtkWidget *win, *pix;
+	GError *error = NULL;
+	gchar *resource_path;
 
-	pixbuf = gdk_pixbuf_new_from_xpm_data (xpm);
+	resource_path = g_strconcat ("/org.gnome.Evolution/", image_name, NULL);
+	pixbuf = gdk_pixbuf_new_from_resource (resource_path, &error);
+	if (!pixbuf)
+		g_warning ("%s: Failed to load '%s': %s", G_STRFUNC, resource_path, error ? error->message : "Unknown error");
+	g_clear_error (&error);
+	g_clear_pointer (&resource_path, g_free);
 
 	win = gtk_window_new (GTK_WINDOW_POPUP);
 	gtk_window_set_type_hint (GTK_WINDOW (win), GDK_WINDOW_TYPE_HINT_NOTIFICATION);
@@ -490,8 +494,8 @@ ethi_add_drop_marker (ETableHeaderItem *ethi,
 		x += ethi->group_indent_width;
 
 	if (!arrow_up) {
-		arrow_up = make_shaped_window_from_xpm (arrow_up_xpm);
-		arrow_down = make_shaped_window_from_xpm (arrow_down_xpm);
+		arrow_up = make_shaped_window_from_svg ("arrow-up.svg");
+		arrow_down = make_shaped_window_from_svg ("arrow-down.svg");
 	}
 
 	canvas = GNOME_CANVAS_ITEM (ethi)->canvas;
diff --git a/src/em-format/e-mail-formatter-headers.c b/src/em-format/e-mail-formatter-headers.c
index dd3230241d..7801a6781d 100644
--- a/src/em-format/e-mail-formatter-headers.c
+++ b/src/em-format/e-mail-formatter-headers.c
@@ -23,6 +23,7 @@
 #include <libedataserver/libedataserver.h>
 
 #include <e-util/e-util.h>
+#include "e-util/e-util-private.h"
 #include <libemail-engine/libemail-engine.h>
 #include <shell/e-shell.h>
 
diff --git a/src/mail/message-list.c b/src/mail/message-list.c
index 001def16eb..77ecc884ab 100644
--- a/src/mail/message-list.c
+++ b/src/mail/message-list.c
@@ -2015,7 +2015,6 @@ ml_tree_value_at_ex (ETreeModel *etm,
 
 		if (!colour) {
 			if (camel_message_info_get_flags (msg_info) & CAMEL_MESSAGE_FLAGGED) {
-				/* FIXME: extract from the important.xpm somehow. */
 				colour = "#A7453E";
 			} else if (((followup && *followup) || (due_by && *due_by)) && !(completed && *completed)) {
 				time_t now = time (NULL);
-- 
GitLab

